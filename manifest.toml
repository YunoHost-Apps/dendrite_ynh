#:schema https://raw.githubusercontent.com/YunoHost/apps/master/schemas/manifest.v2.schema.json

packaging_format = 2

id = "dendrite"
name = "Dendrite"
description.en = "Matrix homeserver of second generation"
description.fr = "Serveur Matrix de seconde génération"

version = "0.15.2~ynh1"

maintainers = ["tituspijean"]

[upstream]
license = "Apache-2.0"
website = "https://matrix.org/"
admindoc = "https://github.com/element-hq/dendrite/tree/master/docs"
code = "https://github.com/element-hq/dendrite"

[integration]
yunohost = ">= 12.0.9"
helpers_version = "2.1"
architectures = "all"
multi_instance = false

ldap = "not_relevant"
sso = "not_relevant"

disk = "50M"
ram.build = "50M"
ram.runtime = "50M"

[antifeatures]
deprecated-software.en = "Dendrite is in maintenance mode: only security fixes will be made to it. It will notably not get support for Sliding Sync and OIDC, breaking its use with the Element X client."
deprecated-software.fr = "Dendrite est en mode maintenance : seuls des correctifs de sécurité seront déployés. En particulier, elle ne recevra pas le support pour le Sliding Sync et l'OIDC, empêchant son fonctionnement correct avec le client Element X."

[install]

    [install.domain]
    help.en = "Select the domain onto which Dendrite will be exclusively installed, e.g. dendrite.domain.tld"
    help.fr = "Sélectionnez le domaine exclusivement dédié à Dendrite, par exemple dendrite.domain.tld"
    type = "domain"

    [install.init_main_permission]
    type = "group"
    default = "visitors"

    [install.server_name]
    ask.en = "Select the display name for your Dendrite server"
    ask.fr = "Sélectionnez le nom d'affichage pour votre serveur Dendrite"
    help.en = "If you choose domain.tld, your Matrix user-ids will be looking like @user:domain.tld instead of @user:dendrite.domain.tld"
    help.fr = "Si vous choisissez domain.tld, vos identifiants Matrix ressembleront à @utilisateur:domain.tld plutôt que @utilisateur:dendrite.domain.tld"
    type = "domain"

    [install.registration]
    ask.en = "Should the server allow any visitor to register as a user?"
    ask.fr = "Le serveur doit-il permettre à quiconque de s'enregistrer comme utilisateur ?"
    type = "boolean"
    help.en = "If no, accounts should be registered by an admin after defining a secret. If yes, to protect your server and the federation from spammer, federation will be deactived by default. You must Activate CAPTCHA verification before federation reactivation. See Config Panel for instructions"
    help.fr = "Si non, les comptes seront créés par un admin après avoir défini un secret. Si oui, la fédération sera désactivée pour protéger la fédération et vous des spammeurs. Activez la vérification par CAPTCHA avant de réactiver la fédération ! Voir les instructions dans le Config Panel"
    default = false

[resources]
    [resources.sources.main]
    url = "https://github.com/element-hq/dendrite/archive/refs/tags/v0.15.2.tar.gz"
    sha256 = "d22e10fa35a02121ea80eb71c8237005bf18915667a9c6268c21f9ae74140231"
    autoupdate.strategy = "latest_github_tag"

    [resources.system_user]

    [resources.install_dir]

    [resources.permissions]
    main.url = "/"
    main.allowed = "visitors"
    main.show_tile = false

    server_api.url = "__DOMAIN__/_matrix"
    server_api.label = "Server access for client apps."
    server_api.show_tile = false
    server_api.allowed = "visitors"
    server_api.auth_header = false
    server_api.protected = true

    server_client_infos.url = "__SERVER_NAME__/.well-known/matrix"
    server_client_infos.label = "Server info for clients. (well-known)"
    server_client_infos.show_tile = false
    server_client_infos.allowed = "visitors"
    server_client_infos.auth_header = false
    server_client_infos.protected = true

    [resources.ports]
    main.default = 8008
    tls.default = 8448
    tls.exposed = "TCP"

    [resources.apt]
    packages = "postgresql"

    [resources.database]
    type = "postgresql"
